<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω Thi ƒêua - GitHub Version</title>
    <style>
      body { font-family: 'Segoe UI', sans-serif; background: #f4f6f8; padding: 15px; margin: 0; }
      .container { max-width: 950px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow: hidden; }
      
      /* Tabs */
      .tab { display: flex; background: #004d40; }
      .tab button { flex: 1; padding: 15px; border: none; background: none; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; }
      .tab button:hover { background: #00695c; }
      .tab button.active { background: #00796b; border-bottom: 4px solid #b2dfdb; }
      .tabcontent { padding: 20px; display: none; }
      .tabcontent.active { display: block; }

      /* Form Style */
      label { font-weight: 600; display: block; margin-bottom: 5px; margin-top: 10px; color: #333; }
      input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
      .row { display: flex; gap: 15px; flex-wrap: wrap; }
      .col { flex: 1; min-width: 200px; }
      
      .btn { width: 100%; padding: 12px; border: none; border-radius: 4px; color: white; font-weight: bold; cursor: pointer; margin-top: 15px; }
      .btn-save { background: #2e7d32; }
      .btn-search { background: #1565c0; }
      .btn:disabled { background: #ccc; cursor: not-allowed; }

      /* Table Result Style */
      .table-wrapper { overflow-x: auto; margin-top: 15px; }
      table { width: 100%; border-collapse: collapse; min-width: 900px; font-size: 13px; }
      th, td { padding: 10px; border: 1px solid #ddd; text-align: left; vertical-align: middle; }
      th { background: #00796b; color: white; text-transform: uppercase; font-size: 0.85em; }
      tr:nth-child(even) { background: #f9f9f9; }
      
      .plus { color: green; font-weight: bold; }
      .minus { color: red; font-weight: bold; }
      .total { color: blue; font-weight: 900; font-size: 1.1em; }
      .rank { background-color: #ffecb3; font-weight: bold; text-align: center; color: #e65100; }
      
      /* Loading Spinner */
      .loader { border: 4px solid #f3f3f3; border-radius: 50%; border-top: 4px solid #00796b; width: 20px; height: 20px; animation: spin 2s linear infinite; display: none; margin: 10px auto; }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="container">
      <div class="tab">
        <button class="tablinks active" onclick="openTab(event, 'Input')">üìù NH·∫¨P LI·ªÜU</button>
        <button class="tablinks" onclick="openTab(event, 'Search')">üîç TRA C·ª®U</button>
      </div>

      <div id="Input" class="tabcontent active">
        <form id="myForm">
          <div class="row">
            <div class="col"><label>Tu·∫ßn thi ƒëua</label><input type="text" name="tuan" placeholder="Tu·∫ßn 1..." required></div>
            <div class="col"><label>L·ªõp</label><input type="text" name="lop" placeholder="10TN..." required></div>
          </div>
          <div class="row">
             <div class="col"><label>Ng∆∞·ªùi nh·∫≠p</label><input type="text" name="hoten" required></div>
             <div class="col"><label>Email</label><input type="email" name="email"></div>
          </div>
          <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;">
          
          <div class="row">
            <div class="col" style="flex: 0 0 80px;"><label>ƒêi·ªÉm (+)</label><input type="number" name="diemThuong"></div>
            <div class="col"><label>N·ªôi dung Th∆∞·ªüng</label><input type="text" name="mcThuong"></div>
          </div>
          
          <div class="row">
            <div class="col" style="flex: 0 0 80px;"><label>ƒêi·ªÉm (-)</label><input type="number" name="diemPhat"></div>
            <div class="col"><label>N·ªôi dung Ph·∫°t</label><input type="text" name="mcPhat"></div>
          </div>

           <div class="row">
             <div class="col"><label>X·∫øp H·∫°ng</label><input type="text" name="hang"></div>
             <div class="col"><label>Ban Thi ƒêua</label><input type="text" name="banThiDua"></div>
          </div>
          <label>Ghi nh·∫≠n ƒêo√†n tr∆∞·ªùng</label><input type="text" name="ghiNhanDoanTruong">
          
          <input type="hidden" name="yKien">
          <input type="hidden" name="ghiChu">

          <button type="submit" class="btn btn-save">L∆ØU K·∫æT QU·∫¢</button>
        </form>
        <div class="loader" id="loaderInput"></div>
        <p id="msg" style="text-align:center; color:green; margin-top:10px;"></p>
      </div>

      <div id="Search" class="tabcontent">
        <div class="row">
          <div class="col">
            <input type="text" id="searchInput" placeholder="Nh·∫≠p t√™n L·ªöP ho·∫∑c TU·∫¶N...">
          </div>
          <div class="col" style="flex: 0 0 100px;">
             <button onclick="searchData()" class="btn btn-search" style="margin-top:10px">T√¨m</button>
          </div>
        </div>
        <div class="loader" id="loaderSearch"></div>
        <div id="resultsArea" class="table-wrapper"></div>
      </div>
    </div>

    <script>
      // ==========================================
      // LINK WEB APP C·ª¶A B·∫†N ƒê√É ƒê∆Ø·ª¢C CH√àN V√ÄO ƒê√ÇY:
      const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw5lWLYn1phFshadZMVprSkbCGyqrMdFN7Byor-Z6MdSSuize1fQNkmqHydXO0euag/exec";
      // ==========================================

      function openTab(evt, tabName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) { tabcontent[i].style.display = "none"; }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) { tablinks[i].className = tablinks[i].className.replace(" active", ""); }
        document.getElementById(tabName).style.display = "block";
        if(evt) evt.currentTarget.className += " active";
      }

      // X·ª≠ l√Ω Form Submit (G·ª≠i d·ªØ li·ªáu)
      const form = document.getElementById('myForm');
      form.addEventListener('submit', e => {
        e.preventDefault();
        
        const btn = document.querySelector(".btn-save");
        const loader = document.getElementById("loaderInput");
        const msg = document.getElementById("msg");
        
        btn.disabled = true;
        btn.textContent = "ƒêang g·ª≠i...";
        loader.style.display = "block";
        msg.textContent = "";

        // Chuy·ªÉn FormData sang JSON object
        const formData = new FormData(form);
        const data = {};
        formData.forEach((value, key) => data[key] = value);

        fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify(data)
        })
        .then(res => res.json())
        .then(response => {
           if(response.result === "success") {
             form.reset();
             msg.textContent = response.message;
           } else {
             msg.textContent = "L·ªói: " + JSON.stringify(response.error);
             msg.style.color = "red";
           }
        })
        .catch(err => {
           msg.textContent = "L·ªói k·∫øt n·ªëi: " + err;
           msg.style.color = "red";
        })
        .finally(() => {
           btn.disabled = false;
           btn.textContent = "L∆ØU K·∫æT QU·∫¢";
           loader.style.display = "none";
        });
      });

      // X·ª≠ l√Ω T√¨m ki·∫øm
      function searchData() {
        var keyword = document.getElementById("searchInput").value;
        if(!keyword) return;

        const loader = document.getElementById("loaderSearch");
        const div = document.getElementById("resultsArea");
        
        div.innerHTML = "";
        loader.style.display = "block";

        fetch(SCRIPT_URL + "?action=search&keyword=" + encodeURIComponent(keyword))
        .then(res => res.json())
        .then(data => {
            if (data.length === 0) {
              div.innerHTML = "<p style='text-align:center; color:red'>Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu!</p>";
              return;
            }
            
            var html = "<table>";
            html += "<tr><th style='width:10%'>TU·∫¶N</th><th style='width:10%'>L·ªöP</th><th style='width:5%'>TH∆Ø·ªûNG</th><th style='width:25%'>N·ªòI DUNG</th><th style='width:5%'>PH·∫†T</th><th style='width:25%'>N·ªòI DUNG</th><th style='width:10%'>T·ªîNG</th><th style='width:10%'>H·∫†NG</th></tr>";
            
            data.forEach(row => {
              html += "<tr>";
              html += "<td style='font-weight:bold'>" + row.tuan + "</td>";
              html += "<td style='font-weight:bold; color:#004d40'>" + row.lop + "</td>";
              html += "<td class='plus'>" + row.thuong + "</td>";
              html += "<td>" + row.mcThuong + "</td>";
              html += "<td class='minus'>" + row.phat + "</td>";
              html += "<td>" + row.mcPhat + "</td>";
              html += "<td class='total'>" + row.conlai + "</td>";
              html += "<td class='rank'>" + row.hang + "</td>";
              html += "</tr>";
            });
            html += "</table>";
            div.innerHTML = html;
        })
        .catch(err => {
            div.innerHTML = "<p style='color:red'>L·ªói khi t·∫£i d·ªØ li·ªáu: " + err + "</p>";
        })
        .finally(() => {
            loader.style.display = "none";
        });
      }
    </script>
</body>
</html>
